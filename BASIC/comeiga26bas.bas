10 DIM A(20,20),Z(20,20),T(20,20),U(20,20),R(20)
15 DIM X(20,20),Y(20,20)
20 LET E9=1e-7 : REM machine precision approximation
25 LET M9=0
30 PRINT "COMEIG AT JULY 31 1984"
40 READ N
45 PRINT "ORDER = ";N
50 IF N <= 0 THEN stop
60 LET N1=N-1 
80 PRINT "Real part Frank, Imag part Moler"
90 FOR I=1 TO N
100 FOR J=1 TO N
110 IF (I < J) THEN 130
115 LET A(I,J)=J
120 LET Z(I,J)=J-2
125 GOTO 145
130 LET A(I,J)=I
140 LET Z(I,J)=I-2
145 LET Y(I,J)=Z(I,J)
150 LET X(I,J)=A(I,J)
155 LET T(I,J)=0
160 LET U(I,J)=0
170 IF I<>J THEN 190
180 LET T(I,I)=1
190 REM PRINT
200 NEXT J
210 NEXT I
230 LET I3=0
240 LET I3=I3+1
250 IF I3>35 THEN 2220
260 IF M9=1 THEN 2220
270 LET T9=0
280 FOR K=1 TO N
290 LET T8=0
300 FOR I=1 TO N
310 IF I=K THEN 330
320 LET T8=T8+ABS(A(I,K))+ABS(Z(I,K))
330 NEXT I
340 LET T9=T9+T8
350 LET R(K)=T8+ABS(A(K,K))+ABS(Z(K,K))
360 NEXT K
370 PRINT "TAU=";T9;"  AT ITN ";I3
380 FOR K=1 TO N1
390 LET S9=R(K)
400 LET I=K
410 LET K1=K+1
420 FOR J=K1 TO N
430 IF S9>=R(J) THEN 460
440 LET S9=R(J)
450 LET I=J
460 NEXT J
470 IF I=K THEN 710
480 LET R(I)=R(K)
490 FOR J=1 TO N
500 LET T7=A(K,J)
510 LET A(K,J)=A(I,J)
520 LET A(I,J)=T7
530 LET T7=Z(K,J)
540 LET Z(K,J)=Z(I,J)
550 LET Z(I,J)=T7
560 NEXT J
570 FOR J=1 TO N
580 LET T7=A(J,K)
590 LET A(J,K)=A(J,I)
600 LET A(J,I)=T7
610 LET T7=Z(J,K)
620 LET Z(J,K)=Z(J,I)
630 LET Z(J,I)=T7
640 LET T7=T(J,K)
650 LET T(J,K)=T(J,I)
660 LET T(J,I)=T7
670 LET T7=U(J,K)
680 LET U(J,K)=U(J,I)
690 LET U(J,I)=T7
700 NEXT J
710 NEXT K
720 IF T9<100*E9 THEN 2220
730 LET M9=1
740 FOR K=1 TO N1
750 LET K1=K+1
760 FOR M=K1 TO N
770 LET H1=0
780 LET H2=0
790 LET H3=0
800 LET G=0
810 FOR I=1 TO N
820 IF I=K THEN 920
830 IF I=M THEN 920
840 LET H3=H3+A(K,I)*A(M,I)+Z(K,I)*Z(M,I)
850 LET H3=H3-A(I,K)*A(I,M)-Z(I,K)*Z(I,M)
860 LET H2=H2+Z(K,I)*A(M,I)-A(K,I)*Z(M,I)
870 LET H2=H2-A(I,K)*Z(I,M)+Z(I,K)*A(I,M)
880 LET T6=A(I,K)*A(I,K)+Z(I,K)*Z(I,K)+A(M,I)*A(M,I)+Z(M,I)*Z(M,I)
890 LET T5=A(I,M)*A(I,M)+Z(I,M)*Z(I,M)+A(K,I)*A(K,I)+Z(K,I)*Z(K,I)
900 LET G=G+T6+T5
910 LET H1=H1-T6+T5
920 NEXT I
930 LET B1=A(K,M)+A(M,K)
940 LET B2=Z(K,M)+Z(M,K)
950 LET E1=A(K,M)-A(M,K)
960 LET E2=Z(K,M)-Z(M,K)
970 LET D1=A(K,K)-A(M,M)
980 LET D2=Z(K,K)-Z(M,M)
990 LET T6=B1*B1+E2*E2+D1*D1
1000 LET T5=B2*B2+E1*E1+D2*D2
1010 IF T6<T5 THEN 1090
1020 LET S8=1
1030 LET C1=B1
1040 LET S=E2
1050 LET C3=D1
1060 LET C4=D2
1070 LET R8=SQR(T6)
1080 GOTO 1150
1090 LET S8=-1
1100 LET C1=B2
1110 LET S=-E1
1120 LET C3=D2
1130 LET C4=D1
1140 LET R8=SQR(T5)
1150 LET R7=SQR(S*S+C1*C1)
1160 LET S6=-1
1170 IF C3<0 THEN 1190
1180 LET S6=1
1190 LET S7=0
1200 LET C7=-1
1210 IF C1<0 THEN 1230
1220 LET C7=1
1230 IF R7>E9 THEN 1360
1240 LET S5=0
1250 LET S7=0
1260 LET C5=1
1270 LET C7=1
1280 IF S8>0 THEN 1320
1290 LET E=E2
1300 LET B=-B1
1310 GOTO 1340
1320 LET E=E1
1330 LET B=B2
1340 LET S4=C3*C3+C4*C4
1350 GOTO 1570
1360 IF ABS(S)<=E9 THEN 1390
1370 LET C7=C1/R7
1380 LET S7=S/R7
1390 LET C9=C3/R7
1400 LET C0=C9+(S6*SQR(1+C9*C9))
1410 LET S5=S6/SQR(1+C0*C0)
1420 LET C5=S5*C0
1430 LET E3=(E1*B1+E2*B2)/R7
1440 LET T4=(B1*B2-E1*E2)/R7
1450 LET T6=S6*(T4*C3-C4*R7)/R8
1460 LET T5=(C3*C4+R7*T4)/R8
1470 LET S4=R8*R8+T5*T5
1480 LET T5=H1*C5*S5
1490 LET C2=C7*C7-S7*S7
1500 LET S2=2*C7*S7
1510 LET T8=H3*C2+H2*S2
1520 LET T7=H2*C2-H3*S2
1530 LET H3=H3*C5*C5-T8*S5*S5-C7*T5
1540 LET H2=H2*C5*C5+T7*S5*S5-S7*T5
1550 LET B=S8*T6*C7+E3*S7
1560 LET E=C7*E3-S8*T6*S7
1570 LET S=H3-S6*R8*E
1580 LET C1=H2-S6*R8*B
1590 LET R9=SQR(C1*C1+S*S)
1600 IF R9>=E9 THEN 1660
1610 LET C8=1
1620 LET C6=1
1630 LET S0=0
1640 LET S1=0
1650 GOTO 1730
1660 LET C8=-C1/R9
1670 LET S0=S/R9
1680 LET T5=C8*B-E*S0
1690 LET Q8=T5*T5
1700 LET Q9=R9/(G+2*(Q8+S4))
1710 LET C6=1/SQR(1-Q9*Q9)
1720 LET S1=C6*Q9
1730 LET T8=S5*S1*(S7*C8-S0*C7)
1740 LET Q7=C5*C6-T8
1750 LET Q6=C5*C6+T8
1760 LET Q5=-S5*S1*(C7*C8+S7*S0)
1770 LET Q4=Q5
1780 LET T7=S5*C6*C7
1790 LET T8=C5*S1*S0
1800 LET P1=T7-T8
1810 LET P2=-T7-T8
1820 LET T7=S5*C6*S7
1830 LET T8=C5*S1*C8
1840 LET P3=T7+T8
1850 LET P4=T7-T8
1860 LET T8=SQR(P1*P1+P3*P3)
1870 LET T7=SQR(P2*P2+P4*P4)
1880 IF T7>E9 THEN 1900
1890 IF T8<=E9 THEN 2190
1900 LET M9=0
1910 FOR I=1 TO N
1920 LET P5=A(K,I)
1930 LET P6=A(M,I)
1940 LET P7=Z(K,I)
1950 LET P8=Z(M,I)
1960 LET A(K,I)=Q7*P5-Q5*P7+P1*P6-P3*P8
1970 LET Z(K,I)=Q7*P7+Q5*P5+P1*P8+P3*P6
1980 LET A(M,I)=P2*P5-P4*P7+Q6*P6-Q4*P8
1990 LET Z(M,I)=P2*P7+P4*P5+Q6*P8+Q4*P6
2000 NEXT I
2010 FOR I=1 TO N
2020 LET P5=A(I,K)
2030 LET P6=A(I,M)
2040 LET P7=Z(I,K)
2050 LET P8=Z(I,M)
2060 LET A(I,K)=Q6*P5-Q4*P7-P2*P6+P4*P8
2070 LET Z(I,K)=Q6*P7+Q4*P5-P2*P8-P4*P6
2080 LET A(I,M)=-P1*P5+P3*P7+Q7*P6-Q5*P8
2090 LET Z(I,M)=-P1*P7-P3*P5+Q7*P8+Q5*P6
2100 LET P5=T(I,K)
2110 LET P6=T(I,M)
2120 LET P7=U(I,K)
2130 LET P8=U(I,M)
2140 LET T(I,K)=Q6*P5-Q4*P7-P2*P6+P4*P8
2150 LET U(I,K)=Q6*P7+Q4*P5-P2*P8-P4*P6
2160 LET T(I,M)=-P1*P5+P3*P7+Q7*P6-Q5*P8
2170 LET U(I,M)=-P1*P7-P3*P5+Q7*P8+Q5*P6
2180 NEXT I
2190 NEXT M
2200 NEXT K
2210 GOTO 240
2220 IF I3<=35 THEN 2240
2230 PRINT "FAILURE TO CONVERGE IN 35 ITERATIONS"
2240 PRINT "EIGENSOLUTIONS"
2250 FOR I=1 TO N
2260 LET G=T(1,I)*T(1,I)+U(1,I)*U(1,I)
2270 LET K=1
2280 IF N=1 THEN 2350
2290 FOR M=2 TO N
2300 LET B=T(M,I)*T(M,I)+U(M,I)*U(M,I)
2310 IF B<=G THEN 2340
2320 LET K=M
2330 LET G=B
2340 NEXT M
2350 LET E=T(K,I)/G
2360 LET S=-U(K,I)/G
2370 FOR K=1 TO N
2380 LET G=T(K,I)*E-U(K,I)*S
2390 LET U(K,I)=U(K,I)*E+T(K,I)*S
2400 LET T(K,I)=G
2410 NEXT K
2430 PRINT "EIGENVALUE";I;"=(";A(I,I);",";Z(I,I);")"
2440 PRINT "VECTOR"
2450 FOR K=1 TO N
2460 PRINT "(";T(K,I);",";U(K,I);")"
2470 NEXT K
2480 PRINT "RESIDUALS"
2490 FOR J=1 TO N
2500 LET S=-A(I,I)*T(J,I)+Z(I,I)*U(J,I)
2510 LET G=-Z(I,I)*T(J,I)-A(I,I)*U(J,I)
2520 FOR K=1 TO N
2530 LET S=S+X(J,K)*T(K,I)-Y(J,K)*U(K,I)
2540 LET G=G+X(J,K)*U(K,I)+Y(J,K)*T(K,I)
2550 NEXT K
2560 PRINT "(";S;",";G;")"
2570 NEXT J
2590 REM
2600 NEXT I
2610 GOTO 40
2620 DATA 1, 5, 0
2800 END 
